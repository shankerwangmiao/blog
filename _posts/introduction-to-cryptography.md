---
title: 密码学基本概念科普
date: 2016-08-07 15:39:28
tags: 
- 技术
---

有很多时候，我们都会涉及到基本的密码学概念。比方说，我要加密一个东西发给别人，应该怎么发？我该如何确信对方的身份？AES MD5 SHA1 DES RSA 这些都是啥跟啥？这些时候，就需要了解一些基本的密码学的概念。这篇文章，基本上就是对着《现代密码学》课程的目录，稍加扩展而成；对于一些算法的细节性的东西，则略过不谈。如果你对介绍的概念有很浓厚的兴趣，你可以去 Google 上搜索到更详细的介绍。

## 古典密码学

古典密码学，研究的是在~~史前~~电子计算机得到广泛应用之前，通过手工计算或简单的机械装置就能完成加解密的一类密码算法。最典型的密码算法，莫过于字母替换了，思路是这样的：

生成一张字母的对应表，如 `A-B B-D C-Z ...` 加密时按这张表格替换，解密时换回来即可。

在这个过程中，我们涉及到了这么几个概念：

* 原文：被加密的文字
* 密文：加密后的文字
* 密码算法：指加密和解密的方法，如这里的“按表格替换”
* 密钥：指的是密码算法的一个参数，如这里的“对应表格”

一般地来说，理想情况下，只有当密钥正确的时候，才能由密文恢复明文（使用解密算法）。并且只要密钥未知，那么从密文恢复明文的唯一方法，就是穷举所有可能的密钥；而由于可能的密钥过多，难以穷举完毕。因此，只要保证密钥的保密性，密文就是安全的。

当然了，稍有经验的人都知道，刚才的“密码算法”，并不符合“理想情况”，因为可以通过统计密文的字母频率等方法，直接推算出密钥，从而破解密文。

## 对称密码算法

然而，现代的密码学研发出的对称密码算法，则在相当大的程度上，可以保证上述的“理想情况”。目前上常用的对称密码学算法有 DES、3DES、AES 等，其中，目前比较安全，且广泛采用的是 AES。

简要概括对称密码算法，就是这样的：

$$密文=加密算法(原文,密钥)$$
$$原文=解密算法(密文,密钥)$$

## 加密模式

现代的对称密码算法，可以用密钥加密一段定长的数据（被称为数据块）。而现实情况下，被加密的数据往往长度不一，甚至有的是数据流，没有确定的长度。因此就会涉及到，怎么针对各种数据应用这些密码算法。

一个很简单的想法是，如果密码算法一次能加密长度为 $b$ 的数据，那就把被加密的数据切割成长度为 $b$ 的小段，分别用同一个密钥 $k$ 进行加密，最后再把得到的密文连接起来，就可以了。解密时，也类似地进行。那么这种办法就是一种“加密模式”，被称之为 ECB。

由于这种加密模式反复使用同一把密钥，被认为降低安全性，因此较不常用。有的加密模式中，会用 $k$ 加密第一段数据；再根据第一段数据的加密结果，将 $k$ 进行变换，变成 $k'$，用于加密第二段数据，这样每一段数据加密时所用的密钥都不相同，提高了安全性。注意，由于加密第二段以及后面数据的密钥是由原始密钥 $k$ 推算出来，所以加密和解密的时候，只需要知道原始的 $k$ 就可以进行了。

在使用类似于 `openssl` 加密数据的时候，可以选择的密码算法都是类似于 `aes-128-cbc`、`aes-256-ecb` 这样的。这里的 `cbc` 和 `ecb` 就是加密模式。

## 哈希算法

哈希算法又称为散列算法。它的输入是任意的，输出是定长的二进制序列。从这一点上来看，必然会出现两组不同的输入产生相同的输出。然而，哈希算法应该有这样的性质：

* 对于给定的输出，没有能行的办法推算输入；
* 对于绝大多数的输入，如果发生改变，则输出也随之发生改变。

常用的哈希算法有 MD5、SHA1、SHA256 等。其中 MD5 已经被视为不安全，SHA1 正在逐步被淘汰，目前 SHA256 和 SHA512 被视为是较为安全的。

## HMAC

HMAC 则是利用了哈希算法，同时引入另外的一个参数 $k$。你可能猜到了，这个 $k$ 是一把密钥。HMAC 与正常的哈希算法的联系和区别是：

* HMAC 是一种基于某种哈希算法的算法，而哈希算法是一类算法；
* 与哈希算法相类似，HMAC 算法的输入（之一）是任意数据，输出是定长的二进制序列；
* 与哈希算法相类似，HMAC 算法亦不能通过输出推定输入，在输入改变时，也会得到不同的输出；
* 与哈希算法不同的是，HMAC 算法的输入还包括了一个密钥 $k$；
* 已知任意多对输入与其输出，不能推算出来密钥 $k$；
* 针对同样的输入，使用不同的密钥 $k$，得到的输出值不同。

HMAC 的算法的大致思路是，对输入进行多次的哈希运算，且运算时将密钥 $k$ 引入，用于对输入以及中间结果进行变换。

正如之前所说，HMAC 是基于一种特定的哈希算法的，因此，你会在很多地方见到 `MD5-HMAC`、`SHA1-HMAC` 之类的写法，这里的 `MD5`、`SHA1` 就是基于的哈希算法。

## 上面的这些东西的应用

我会在这里介绍上面这一串东西在实际上都有什么用途，由于尚未介绍非对称密码，所以我们都先假定：通信双方已经通过某种可靠的方式，获得了共享的密钥 $k$，这个密钥不为其他人所知。

在阐述密码学的应用场景时，我们常常把通信双方取名为 Alice 和 Bob，而且往往是 Alice 要给 Bob 发送消息。

密码学的目的，就是为了保证消息在传输时，不被偷窥和篡改。虽然我国的《宪法》从法律上规定了公民享有通信的保密权利。但是法律这个东西，只有能惩处违反者才有用处，别人偷窥了你的通信你都不知道，你怎么惩处违反者呢？因此，即使有法律保护，也有应用密码学的必要。

### 加密一段消息





